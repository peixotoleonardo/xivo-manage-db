#!/bin/sh

set -e


case "$1" in
    configure)
        new_dir=/var/lib/xivo-manage-db/update-db
        for old_dir in /var/lib/xivo-update-db /var/lib/xivo-upgrade/update-db ; do
            if [ -d "$old_dir" ]; then
                mv "$old_dir"/* "$new_dir"
                rm -fr "$old_dir"
            fi
        done
        # When installing from ISO, Postgres is not running
        pg_status=$(pg_lsclusters | grep '^9.1' | awk '{print $4}')
        if [ "$pg_status" = 'online' ]; then
            /usr/bin/xivo-update-db
        fi
    ;;

    abort-upgrade)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0

#!/bin/bash
# This script initialize role and database
#
# It must be executed as user postgres.

set -e
export PGOPTIONS='--client-min-messages=warning'

psql="psql -v ON_ERROR_STOP="


$psql <<'EOF'
BEGIN;

DO
$body$
BEGIN
   IF NOT EXISTS (
      SELECT *
      FROM   pg_catalog.pg_user
      WHERE  usename = 'asterisk') THEN
        CREATE ROLE "asterisk" WITH LOGIN PASSWORD 'proformatique';
   END IF;
END
$body$
;

COMMIT;

CREATE DATABASE "asterisk" WITH OWNER "asterisk" ENCODING 'UTF8';

EOF
